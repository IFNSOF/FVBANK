<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Auth</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .hidden { display: none; }
        #main-menu { margin-top: 20px; }
        #balance { margin-left: 20px; }
        #auth-form { display: flex; flex-direction: column; }
        input { margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="auth-form" class="hidden">
    <h2>Register or Login</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button id="register-btn">Register</button>
    <button id="login-btn">Login</button>
</div>

<div id="main-menu" class="hidden">
    <div>
        <h2>Welcome <span id="user-id"></span></h2>
        <h3>Balance: $<span id="balance">00.00</span></h3>
    </div>
</div>

<script>
    // Set up Supabase connection
    const supabaseUrl = 'https://your-project.supabase.co'; // Замените на ваш Supabase URL
    const supabaseKey = 'your-api-key'; // Замените на ваш Supabase API Key
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const authForm = document.getElementById('auth-form');
    const mainMenu = document.getElementById('main-menu');
    const registerBtn = document.getElementById('register-btn');
    const loginBtn = document.getElementById('login-btn');
    const userIdElem = document.getElementById('user-id');
    const balanceElem = document.getElementById('balance');

    // Функция для регистрации пользователя
    registerBtn.addEventListener('click', async () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const { user, error } = await supabase.auth.signUp({
            email: username,
            password: password,
        });

        if (error) {
            alert('Error: ' + error.message);
        } else {
            alert('Registration successful! Please log in.');
        }
    });

    // Функция для входа пользователя
    loginBtn.addEventListener('click', async () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const { user, error } = await supabase.auth.signInWithPassword({
            email: username,
            password: password,
        });

        if (error) {
            alert('Error: ' + error.message);
        } else {
            showMainMenu(user);
        }
    });

    // Функция для отображения главного меню
    async function showMainMenu(user) {
        authForm.classList.add('hidden');
        mainMenu.classList.remove('hidden');
        userIdElem.textContent = user.id;

        // Запрос баланса пользователя
        const { data, error } = await supabase
            .from('balances') // Предполагается, что у вас есть таблица 'balances'
            .select('balance')
            .eq('user_id', user.id)
            .single();

        if (data) {
            balanceElem.textContent = data.balance.toFixed(2);
        } else {
            balanceElem.textContent = '00.00'; // Если баланс не найден, отображаем 00.00
        }
    }
</script>

</body>
</html>

